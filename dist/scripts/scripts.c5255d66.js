"use strict";angular.module("robotsOnMarsApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("robotsOnMarsApp").controller("MainCtrl",["$scope","marsAdventure",function(a,b){a.mars=b,a.mars.init("mars"),a.mars.buildSurface(),a.mars.placeRobot(),a.mars.moveRobot()}]),angular.module("robotsOnMarsApp").service("marsAdventure",["$window",function(a){var b=document,c={};return c.initialized=!1,c.gridSet=!1,c.gridSize=null,c.robotScents=[],c.robotOnGrid=!1,c.currentPositionX=null,c.currentPositionY=null,c.currentDirection="N",c.currentTile=null,c.wrap=null,c.init=function(a){c.setPlanet(a),c.setRobot(),c.initialized=!0},c.reset=function(){c.gridSet=!1,c.gridSize=null,c.robotScents=[],c.robotOnGrid=!1,c.currentPositionX=null,c.currentPositionY=null,c.currentDirection="N",c.currentTile=null,c.wrap.empty()},c.setPlanet=function(a){c.wrap=$("#"+a)},c.setRobot=function(){c.robot=b.createElement("div"),c.robot.setAttribute("class","marsRobot"),c.robotIcon='<img src="images/robot-icon.png">',c.robot.innerHTML=c.robotIcon},c.buildSurface=function(d){if(d=d||$("#surfaceSize").val(),d&&""!==d){if(c.gridSet){var e=a.confirm("Reset current planet and related data?");if(!e)return;c.reset()}if(d=d.replace(/[ \t\r]+/g,""),!/^\d+,\d+$/.test(d))return void a.alert("Wrong input, Example input: 4,6");$("#surfaceSize").val("");var f=d.split(",");if(c.gridSize=d,c.width=parseInt(f[0]),c.height=parseInt(f[1]),0===c.width||0===c.height)return void a.alert("Planet Zero?, Grid has to be at least 1,1 size");for(var g=0;g<c.height;g++){var h=b.createElement("div");$(h).addClass("marsRow");for(var i=0;i<c.width;i++){var j=b.createElement("div");$(j).addClass("marsTile"),i===c.width-1&&$(j).addClass("lastTileR"),g===c.height-1&&$(j).addClass("lastTileB"),h.appendChild(j)}c.wrap.append(h)}c.gridSet=!0}},c.placeRobot=function(b){if(b=b||$("#robotPosition").val(),b&&""!==b){if(!c.gridSet)return void a.alert("No planet yet, first set the planet.");if(c.robotOnGrid){var d=a.confirm("Send home current robot and place new?");if(!d)return}if(b=b.replace(/[ \t\r]+/g,""),!/^\d+,\d+$/.test(b))return void a.alert("Wrong input. Example: 2,4");$("#robotPosition").val("");var e=b.split(","),f=parseInt(e[0]),g=parseInt(e[1]);if(0>f||f>c.width-1||0>g||g>c.height-1)return void a.alert("Position off Planet. Mars range: 0,0 to "+(c.width-1)+","+(c.height-1));c.currentPositionX=f,c.currentPositionY=g,c.currentTile=c.getTile(f,g),c.robot.setAttribute("class","marsRobot lookN"),c.currentDirection="N",c.currentTile.append(c.robot),c.robotOnGrid=!0}},c.getTile=function(a,b){var d=c.wrap.find(".marsRow:nth-child("+(c.height-b)+") .marsTile:nth-child("+(a+1)+")");return d?d:null},c.getCurrentLocation=function(){return c.currentPositionX+","+c.currentPositionY+" "+c.currentDirection},c.moveRobot=function(b){if(b=b||$("#moveSequence").val(),b&&""!==b){if(!c.robotOnGrid)return void a.alert("No robot on Mars yet? Place it ^^");if(b=b.replace(/[ \t\r]+/g,""),b=b.toUpperCase(),!/^[FRL]+$/.test(b))return void a.alert("Wrong input. Use only F, L, R (f,l,r) letters for moving");$("#moveSequence").val("");var d,e,f,g="OK",h=b.split("");for(d=0;d<h.length;d++){switch(h[d]){case"F":g=c.moveRobotForward();break;case"L":c.moveRobotLeft();break;case"R":c.moveRobotRight()}if("LOST"===g){e="LOST",c.robotOnGrid=!1;break}if("BLOCKED"===g){e="SAVED";break}}c.outputResult(e),"LOST"===g&&(f=a.confirm("Place new Robot on last location?"),f&&c.placeRobot(c.currentPositionX+","+c.currentPositionY))}},c.updateRobotPosition=function(){c.currentTile=c.getTile(c.currentPositionX,c.currentPositionY),c.currentTile.append(c.robot)},c.moveRobotForward=function(){var a="OK";switch(c.currentDirection){case"N":if(!(c.currentPositionY<c.height-1)){if(-1!==c.robotScents.indexOf(c.getCurrentLocation())){a="BLOCKED";break}a="LOST";break}c.currentPositionY+=1,c.updateRobotPosition();break;case"E":if(!(c.currentPositionX<c.width-1)){if(-1!==c.robotScents.indexOf(c.getCurrentLocation())){a="BLOCKED";break}a="LOST";break}c.currentPositionX+=1,c.updateRobotPosition();break;case"S":if(!(c.currentPositionY>0)){if(-1!==c.robotScents.indexOf(c.getCurrentLocation())){a="BLOCKED";break}a="LOST";break}c.currentPositionY-=1,c.updateRobotPosition();break;case"W":if(!(c.currentPositionX>0)){if(-1!==c.robotScents.indexOf(c.getCurrentLocation())){a="BLOCKED";break}a="LOST";break}c.currentPositionX-=1,c.updateRobotPosition()}return"LOST"===a&&(c.addScent(),c.robot.remove(),c.robotOnGrid=!1),a},c.moveRobotLeft=function(){switch(c.currentDirection){case"N":c.robot.setAttribute("class","marsRobot lookW"),c.currentDirection="W";break;case"E":c.robot.setAttribute("class","marsRobot lookN"),c.currentDirection="N";break;case"S":c.robot.setAttribute("class","marsRobot lookE"),c.currentDirection="E";break;case"W":c.robot.setAttribute("class","marsRobot lookS"),c.currentDirection="S"}},c.moveRobotRight=function(){switch(c.currentDirection){case"N":c.robot.setAttribute("class","marsRobot lookE"),c.currentDirection="E";break;case"E":c.robot.setAttribute("class","marsRobot lookS"),c.currentDirection="S";break;case"S":c.robot.setAttribute("class","marsRobot lookW"),c.currentDirection="W";break;case"W":c.robot.setAttribute("class","marsRobot lookN"),c.currentDirection="N"}},c.addScent=function(){var a=c.getTile(c.currentPositionX,c.currentPositionY);switch(c.robotScents.push(c.getCurrentLocation()),c.currentDirection){case"N":a.addClass("safeN");break;case"E":a.addClass("safeE");break;case"S":a.addClass("safeS");break;case"W":a.addClass("safeW")}},c.outputResult=function(a){a=a||"",$("#sequenceOutput").append("<p>"+c.getCurrentLocation()+" "+a+"</p>")},c}]);